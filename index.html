<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Coveo Atomic Search</title>

  <script type="module" src="https://static.cloud.coveo.com/atomic/v3/atomic.esm.js"></script>
  <link rel="stylesheet" href="https://static.cloud.coveo.com/atomic/v3/themes/coveo.css"/>

  <style>
    body { 
        margin: 0; 
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
        background-color: #f4f6f9;
        color: #333;
    }
    .header {
        background: linear-gradient(135deg, #0d47a1 0%, #1976d2 100%);
        color: white;
        padding: 2rem 1rem;
        text-align: center;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .header h1 {
        margin: 0;
        font-size: 2.5rem;
    }
    .container {
        max-width: 1200px;
        margin: 2rem auto;
        padding: 0 1rem;
    }
    atomic-search-layout { 
        --atomic-font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        --atomic-primary-color: #1976d2;
        --atomic-border-radius: 8px;
        --atomic-border-color: #e0e0e0;
    }
    atomic-search-box {
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    atomic-result-list {
        gap: 1.5rem;
    }
    .result-root {
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        border-radius: 8px;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .result-root:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 16px rgba(0,0,0,0.12);
    }
    atomic-facet {
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 1rem;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    /* Panic Button Styling */
    .panic-button {
        position: fixed;
        bottom: 30px;
        right: 30px;
        background: linear-gradient(135deg, #ff4b2b 0%, #ff416c 100%);
        color: white;
        border: 4px solid #ffeb3b;
        border-radius: 50%;
        width: 120px;
        height: 120px;
        font-size: 48px;
        font-weight: bold;
        cursor: pointer;
        box-shadow: 0 8px 25px rgba(255, 75, 43, 0.6), inset 0 0 10px rgba(255, 255, 255, 0.2);
        z-index: 1000;
        transition: transform 0.2s, box-shadow 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: 'Comic Sans MS', cursive;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        animation: panic-bounce 2s infinite;
    }

    .panic-button:hover {
        transform: scale(1.15) rotate(10deg);
        background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
        box-shadow: 0 12px 35px rgba(255, 75, 43, 0.8), inset 0 0 15px rgba(255, 255, 255, 0.3);
    }

    @keyframes panic-bounce {
        0%, 100% {
            transform: translateY(0px);
        }
        50% {
            transform: translateY(-10px);
        }
    }

    /* Modal Overlay */
    .panic-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        z-index: 2000;
        justify-content: center;
        align-items: center;
        flex-direction: column;
    }

    .panic-overlay img {
        max-width: 80%;
        max-height: 70vh;
        border: 5px solid white;
        border-radius: 8px;
    }

    .panic-overlay h2 {
        color: white;
        margin-top: 20px;
        font-family: 'Comic Sans MS', cursive;
    }

    .close-panic {
        position: absolute;
        top: 20px;
        right: 30px;
        color: white;
        font-size: 40px;
        cursor: pointer;
    }
  </style>

  <script>
    (async () => {
      // Wait for the Atomic components to load
      await customElements.whenDefined('atomic-search-interface');
      
      const searchInterface = document.querySelector('#search');

      // Initialize with credentials
      await searchInterface.initialize({
        accessToken: 'xxb0be3d51-5f26-49cc-b278-a6af93789048',
        organizationId: 'yorickcrusebachallengeha5gut65'
      });

      // Trigger the first search query automatically
      searchInterface.executeFirstSearch();
    })();

    //panic
    function togglePanic() {
        const overlay = document.getElementById('panicOverlay');
        if (overlay.style.display === 'flex') {
            overlay.style.display = 'none';
        } else {
            overlay.style.display = 'flex';
        }
    }
  </script>
</head>
<body>

  <header class="header">
    <h1>The perfect product search</h1>
  </header>

  <main class="container">
    <atomic-search-interface id="search" pipeline="challenge_decathlon" fields-to-include='["product_thumbnail", "product_sku", "product_price", "product_category", "scraped_categories"]' analytics="true">
      <atomic-search-layout>
        
        <atomic-layout-section section="search">
          <atomic-search-box>
            <atomic-search-box-query-suggestions></atomic-search-box-query-suggestions>
          </atomic-search-box>
        </atomic-layout-section>
        
        <atomic-layout-section section="facets">
          <atomic-facet field="scraped_categories" label="Categories" depends-on="scraped_categories"></atomic-facet>
          <atomic-facet field="product_category" label="Category" depends-on="product_category"></atomic-facet>
          <atomic-numeric-facet field="product_price" label="Price" with-input="integer" range-algorithm="even"></atomic-numeric-facet>
        </atomic-layout-section>

        <atomic-layout-section section="main">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <atomic-query-summary></atomic-query-summary>
            <atomic-sort-dropdown>
              <atomic-sort-expression label="Relevance" expression="relevancy"></atomic-sort-expression>
              <atomic-sort-expression label="Price (low to high)" expression="product_price ascending"></atomic-sort-expression>
              <atomic-sort-expression label="Price (high to low)" expression="product_price descending"></atomic-sort-expression>
            </atomic-sort-dropdown>
          </div>
          <atomic-layout-section section="results">
            <atomic-no-results>
            </atomic-no-results>
            <atomic-result-list>
              <atomic-result-template>
                <template>
                  <style>
                    .result-root { 
                      display: flex; 
                      align-items: flex-start; 
                      gap: 1rem; 
                      padding: 1rem; 
                      border-bottom: 1px solid #eee;
                    }
                    .result-image { 
                      flex: 0 0 150px; 
                      border: 1px solid #eee;
                      border-radius: 4px;
                      overflow: hidden;
                    }
                    .result-content { flex: 1; }
                    .result-price { font-weight: bold; margin-top: 0.5rem; }
                    .result-sku { color: #666; font-size: 0.9rem; margin-top: 0.5rem; }
                  </style>
                  <div class="result-root">
                    <div class="result-image">
                      <atomic-result-image field="product_thumbnail" loading="lazy" fallback="https://placehold.co/150x150?text=No+Image+Available"></atomic-result-image>
                    </div>
                    <div class="result-content">
                      <atomic-result-link></atomic-result-link>
                      <atomic-result-printable-uri></atomic-result-printable-uri>
                      <div class="result-price">
                        <atomic-result-number field="product_price">
                          <atomic-format-currency currency="CAD"></atomic-format-currency>
                        </atomic-result-number>
                      </div>
                      <div class="result-sku">
                           SKU: <atomic-result-number field="product_sku"></atomic-result-number>
                      </div>
                    </div>
                  </div>
                </template>
              </atomic-result-template>
            </atomic-result-list>
          </atomic-layout-section>
        </atomic-layout-section>

      </atomic-search-layout>
    </atomic-search-interface>
  </main>

  <button class="panic-button" onclick="togglePanic()">ðŸ†˜</button>

  <div id="panicOverlay" class="panic-overlay" onclick="togglePanic()">
      <span class="close-panic">&times;</span>
      <img src="static/charlie-meme.jpg" alt="Charlie Conspiracy">
  </div>

</body>
</html>